<!DOCTYPE html>
<html>
<head>
    <title>UIC Metrics</title>

<!--
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.0/jquery-1.8.0.min.js"></script>
-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
    <script src="https://raw.github.com/jburnett/azure-metrics/master/lib/azure-metrics.js"></script>
<!-- This is a special version of jQuery with RequireJS built-in -->
<script data-main="../js/main" src="../js/require-jquery.js"></script>
    <script src="/js/test.js"></script>
    
<!--    
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js"></script>
 -->   
    <script type="text/javascript">
    
        function createMetricsTable(data) {
            var tblOuter = $('<table />');
            var metricsMap = data.map( function(m) {
                return {
                    PartitionKey: m.PartitionKey,
                    RowKey: m.RowKey,
                    Metrics: m
                };
            });
            
            $.each(data, function(key, metrics) {
                var tblRowOuter = $('<tr/>').appendTo(tblOuter);
                var tblRowInner = $('<tr/>');
                
                $.each(metrics, function(name, value) {
                    $('<td>' + name + ': ' + value + '</td>').appendTo(tblRowInner);
                });
                
                (tblRowInner.appendTo($('<table />'))).appendTo(tblRowOuter);
            });
            
            $("#metrics-container").append( tblOuter );
        }
        
        
//        function addMetricsTable(targetElement, metricsData) {
        function bodyLoaded() {
        
//            $.getJSON("/data/transactions", {"JB": 7466}, createMetricsTable );
            
//            var set = new Set();
//            if (set === null || set === undefined) {
//                alert("Hmmm. Where is set?");
//            }
            
            var caps = [];
/*            if (window === null || window === undefined) {
                alert("Hmmm. Where is window?");
            }
            if (MetricsService === null || MetricsService === undefined) {
                alert("Hmmm. Where is MetricsService?");
            }
            if (window.MetricsService === null || window.MetricsService === undefined) {
                alert("Hmmm. Where is window.MetricsService?");
            }
*/            
            var azmet = exports.MetricsService.createMetricsService();
            if (azmet === null || azmet === undefined) {
                alert('OOPS!');
            }
            else {
                alert("azmet was not null or undef");
                azmet.getBlobCapacities( function(error, metrics) {
                
                    $.each(data, function(key, metrics) {
                        var tblRowOuter = $('<tr/>').appendTo(tblOuter);
                        var tblRowInner = $('<tr/>');
                    
                        $.each(metrics, function(name, value) {
                            $('<td>' + name + ': ' + value + '</td>').appendTo(tblRowInner);
                        });
                    
                        (tblRowInner.appendTo($('<table />'))).appendTo(tblRowOuter);
                    });
                });
                $("#capacities-container").append( tblOuter );
            }
        }
        
    </script>
    
</head>
<body onload="bodyLoaded();">
    <h3><u>Capacity Metrics sourced with <a href="http://github.com/AltaModaTech/azure-metrics-for-node/">Azure Metrics for Node</a></u></h3>
    <div id="capacities-container" />
    
    <h3><u>Transaction Metrics</u></h3>
    <div id="metrics-container" />
    
    <ul id="xact-list">
    </ul>
    
    
</body>
</html>

